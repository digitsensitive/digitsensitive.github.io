<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="initial-scale=1,width=device-width"><link crossorigin=anonymous href=https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css integrity=sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor rel=stylesheet><script crossorigin=anonymous integrity=sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2 src=https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css><link href=/favicon.ico rel=icon><link rel=stylesheet href=/css/syntax.css><link rel=stylesheet href=/css/styles.css><title>digitsensitive</title></head><body class="p-3 bg-dark"><nav class="navbar navbar-dark navbar-expand-lg"><div class=container-fluid><a class=navbar-brand href=/>Hello</a>
<button aria-controls=navbar aria-expanded=false aria-label="Toggle navigation" class=navbar-toggler data-bs-target=#navbar data-bs-toggle=collapse type=button>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbar><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=/about/ title>About</a></li><li class=nav-item><a class=nav-link href=/notes/ title>Notes</a></li><li class=nav-item><a class=nav-link href=/posts/ title>Posts</a></li></ul></div></div></nav><div class="container text-light py-4 mx-auto" style=max-width:600px><h1>TIC-80</h1><h6>October 18, 2022</h6><div class=mt-4><nav id=TableOfContents><ul><li><a href=#basic-setup>Basic setup</a></li><li><a href=#game-loop>Game loop</a></li><li><a href=#general-helper-functions>General helper functions</a></li><li><a href=#specific-helper-functions>Specific helper functions</a><ul><li><a href=#color-palette>Color palette</a></li><li><a href=#physics>Physics</a></li><li><a href=#sprite-animations>Sprite Animations</a></li><li><a href=#print-text>Print text</a></li></ul></li><li><a href=#simple-scene-manager>Simple Scene Manager</a></li><li><a href=#finite-state-machine>Finite state machine</a></li><li><a href=#simple-particle-system>Simple particle system</a></li></ul></nav><h2 id=basic-setup>Basic setup</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>function</span> <span class=nf>init</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>TIC</span><span class=p>()</span>
</span></span><span class=line><span class=cl> <span class=c1>-- here lies our game loop</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><h2 id=game-loop>Game loop</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>function</span> <span class=nf>TIC</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>global.time</span><span class=o>=</span><span class=n>global.time</span><span class=o>+</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>input</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>if</span> <span class=n>global.time</span><span class=o>%</span><span class=n>global.updateSpeed</span><span class=o>==</span><span class=mi>0</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>        <span class=n>update</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl>    <span class=n>draw</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><h2 id=general-helper-functions>General helper functions</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>function</span> <span class=nf>cos</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=kr>return</span> <span class=n>math.cos</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>sin</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=kr>return</span> <span class=n>math.sin</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>tan</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=kr>return</span> <span class=n>math.tan</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>rnd</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>)</span> <span class=kr>return</span> <span class=n>math.random</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>)</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>rndArray</span><span class=p>(</span><span class=n>a</span><span class=p>)</span> <span class=kr>return</span> <span class=n>a</span><span class=p>[</span><span class=n>math.random</span><span class=p>(</span><span class=o>#</span><span class=n>a</span><span class=p>)]</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>ins</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>e</span><span class=p>)</span> <span class=kr>return</span> <span class=n>table.insert</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>e</span><span class=p>)</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>rmv</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>e</span><span class=p>)</span> <span class=kr>return</span> <span class=n>table.remove</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>e</span><span class=p>)</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- get maximum of two numbers</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>max</span><span class=p>(</span><span class=n>n1</span><span class=p>,</span><span class=n>n2</span><span class=p>)</span> <span class=kr>return</span> <span class=n>math.max</span><span class=p>(</span><span class=n>n1</span><span class=p>,</span><span class=n>n2</span><span class=p>)</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>clamp</span><span class=p>(</span><span class=n>v</span><span class=p>,</span><span class=n>l</span><span class=p>,</span><span class=n>h</span><span class=p>)</span> <span class=kr>return</span> <span class=n>math.min</span><span class=p>(</span><span class=n>math.max</span><span class=p>(</span><span class=n>v</span><span class=p>,</span><span class=n>l</span><span class=p>),</span><span class=n>h</span><span class=p>)</span> <span class=kr>end</span>
</span></span></code></pre></div><p>It might be even easier to use the following shortcuts:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=n>cos</span> <span class=o>=</span> <span class=n>math.cos</span>
</span></span><span class=line><span class=cl><span class=n>sin</span> <span class=o>=</span> <span class=n>math.sin</span>
</span></span><span class=line><span class=cl><span class=n>tan</span> <span class=o>=</span> <span class=n>math.tan</span>
</span></span><span class=line><span class=cl><span class=n>rnd</span> <span class=o>=</span> <span class=n>math.random</span>
</span></span><span class=line><span class=cl><span class=n>sqrt</span> <span class=o>=</span> <span class=n>math.sqrt</span>
</span></span><span class=line><span class=cl><span class=n>rad</span> <span class=o>=</span> <span class=n>math.rad</span>
</span></span><span class=line><span class=cl><span class=n>min</span> <span class=o>=</span> <span class=n>math.min</span>
</span></span><span class=line><span class=cl><span class=n>max</span> <span class=o>=</span> <span class=n>math.max</span>
</span></span><span class=line><span class=cl><span class=n>abs</span> <span class=o>=</span> <span class=n>math.abs</span>
</span></span></code></pre></div><h2 id=specific-helper-functions>Specific helper functions</h2><h3 id=color-palette>Color palette</h3><p>For the standard color palette <code>SWEETIE-16</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- enum for sweetie-16 color palette</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>COLOR</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>BLACK</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>PURPLE</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>RED</span> <span class=o>=</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>ORANGE</span> <span class=o>=</span> <span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>YELLOW</span> <span class=o>=</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>LIGHT_GREEN</span> <span class=o>=</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>GREEN</span> <span class=o>=</span> <span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>DARK_GREEN</span> <span class=o>=</span> <span class=mi>7</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>DARK_BLUE</span> <span class=o>=</span> <span class=mi>8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>BLUE</span> <span class=o>=</span> <span class=mi>9</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>LIGHT_BLUE</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>CYAN</span> <span class=o>=</span> <span class=mi>11</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>WHITE</span> <span class=o>=</span> <span class=mi>12</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>LIGHT_GREY</span> <span class=o>=</span> <span class=mi>13</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>GREY</span> <span class=o>=</span> <span class=mi>14</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>DARK_GREY</span> <span class=o>=</span> <span class=mi>15</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=physics>Physics</h3><h4 id=simple-collision>Simple collision</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- simple rectangle collision</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>collide</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>-- get parameters from a and b</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>ax</span> <span class=o>=</span> <span class=n>a.x</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>ay</span> <span class=o>=</span> <span class=n>a.y</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>aw</span> <span class=o>=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>ah</span> <span class=o>=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>bx</span> <span class=o>=</span> <span class=n>b.x</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>by</span> <span class=o>=</span> <span class=n>b.y</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>bw</span> <span class=o>=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>bh</span> <span class=o>=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>-- check collision</span>
</span></span><span class=line><span class=cl>    <span class=kr>if</span> <span class=n>ax</span> <span class=o>&lt;</span> <span class=n>bx</span> <span class=o>+</span> <span class=n>bw</span> <span class=ow>and</span> <span class=n>ax</span> <span class=o>+</span> <span class=n>aw</span> <span class=o>&gt;</span> <span class=n>bx</span> <span class=ow>and</span> <span class=n>ay</span> <span class=o>&lt;</span> <span class=n>by</span> <span class=o>+</span> <span class=n>bh</span> <span class=ow>and</span> <span class=n>ah</span> <span class=o>+</span> <span class=n>ay</span> <span class=o>&gt;</span> <span class=n>by</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>        <span class=c1>-- collision</span>
</span></span><span class=line><span class=cl>        <span class=kr>return</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl>    <span class=c1>-- no collision</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><h4 id=add-velocity-to-object>Add velocity to object</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>function</span> <span class=nf>addVelocityToObject</span><span class=p>(</span><span class=n>o</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o.x</span> <span class=o>=</span> <span class=n>o.x</span> <span class=o>+</span> <span class=n>o.vx</span>
</span></span><span class=line><span class=cl>    <span class=n>o.y</span> <span class=o>=</span> <span class=n>o.y</span> <span class=o>+</span> <span class=n>o.vy</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><h4 id=apply-friction-to-object>Apply friction to object</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>function</span> <span class=nf>applyFrictionToObject</span><span class=p>(</span><span class=n>o</span><span class=p>,</span><span class=n>fx</span><span class=p>,</span><span class=n>fy</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o.vx</span> <span class=o>=</span> <span class=n>o.vx</span> <span class=o>*</span> <span class=n>fx</span>
</span></span><span class=line><span class=cl>    <span class=n>o.vy</span> <span class=o>=</span> <span class=n>o.vy</span> <span class=o>*</span> <span class=n>fy</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><h4 id=apply-gravity-to-object>Apply gravity to object</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>function</span> <span class=nf>applyGravityToObject</span><span class=p>(</span><span class=n>o</span><span class=p>,</span> <span class=n>g</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o.vy</span> <span class=o>=</span> <span class=n>o.vy</span> <span class=o>+</span> <span class=n>g</span>
</span></span><span class=line><span class=cl>    <span class=n>o.vy</span> <span class=o>=</span> <span class=n>min</span><span class=p>(</span><span class=n>max</span><span class=p>(</span><span class=n>o.vy</span><span class=p>,</span> <span class=o>-</span><span class=mi>3</span><span class=p>),</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><h3 id=sprite-animations>Sprite Animations</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- time returns the number of milliseconds elapsed since the application began</span>
</span></span><span class=line><span class=cl><span class=c1>-- // will auto round the result</span>
</span></span><span class=line><span class=cl><span class=c1>-- as higher the animSpeed, as slower the animation will be</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>animSpeed</span> <span class=o>=</span> <span class=mi>128</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>spriteID</span> <span class=o>=</span> <span class=p>(</span><span class=n>time</span><span class=p>()</span><span class=o>//</span><span class=n>animSpeed</span><span class=p>)</span><span class=o>%</span><span class=mi>2</span>
</span></span></code></pre></div><h3 id=print-text>Print text</h3><h4 id=with-a-border>With a border</h4><p>c1 defines the inner color. c2 defines the border color.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>function</span> <span class=nf>printf</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>c1</span><span class=p>,</span><span class=n>c2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>x</span><span class=o>=</span><span class=n>x</span> <span class=ow>or</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>y</span><span class=o>=</span><span class=n>y</span> <span class=ow>or</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>c1</span><span class=o>=</span><span class=n>c1</span> <span class=ow>or</span> <span class=mi>12</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>c2</span><span class=o>=</span><span class=n>c2</span> <span class=ow>or</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>x</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>c2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span><span class=n>c2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>x</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>c2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>c2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>c1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><h4 id=with-a-shadow-at-the-top>With a shadow at the top</h4><p>c1 defines the shadow color at the top. c2 defines the color of the text.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>function</span> <span class=nf>printf</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>c1</span><span class=p>,</span><span class=n>c2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>x</span><span class=o>=</span><span class=n>x</span> <span class=ow>or</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>y</span><span class=o>=</span><span class=n>y</span> <span class=ow>or</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>c1</span><span class=o>=</span><span class=n>c1</span> <span class=ow>or</span> <span class=mi>12</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>c2</span><span class=o>=</span><span class=n>c2</span> <span class=ow>or</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>c1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=o>+</span><span class=mi>1</span><span class=p>,</span><span class=n>c2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><h4 id=horizontally-centered>Horizontally centered</h4><p>f defines the flag indicating whether fixed width printing is required. s
defines the scale.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>function</span> <span class=nf>printhc</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>c</span><span class=p>,</span><span class=n>f</span><span class=p>,</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>f</span><span class=o>=</span><span class=n>f</span> <span class=ow>or</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>s</span><span class=o>=</span><span class=n>s</span> <span class=ow>or</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>w</span><span class=o>=</span><span class=n>print</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=o>-</span><span class=mi>8</span><span class=p>,</span><span class=o>-</span><span class=mi>8</span><span class=p>)</span><span class=o>*</span><span class=n>s</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>x</span><span class=o>=</span><span class=p>(</span><span class=mi>240</span><span class=o>-</span><span class=n>w</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>c</span><span class=p>,</span><span class=n>f</span><span class=p>,</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><h4 id=vertically-centered>Vertically centered</h4><p>f defines the flag indicating whether fixed width printing is required. s
defines the scale.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>function</span> <span class=nf>printvc</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>c</span><span class=p>,</span><span class=n>f</span><span class=p>,</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>f</span><span class=o>=</span><span class=n>f</span> <span class=ow>or</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>s</span><span class=o>=</span><span class=n>s</span> <span class=ow>or</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>w</span><span class=o>=</span><span class=n>print</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=o>-</span><span class=mi>8</span><span class=p>,</span><span class=o>-</span><span class=mi>8</span><span class=p>)</span><span class=o>*</span><span class=n>s</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>y</span><span class=o>=</span><span class=p>(</span><span class=mi>136</span><span class=o>-</span><span class=mi>6</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>c</span><span class=p>,</span><span class=n>f</span><span class=p>,</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><h4 id=centered>Centered</h4><p>f defines the flag indicating whether fixed width printing is required. s
defines the scale.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>function</span> <span class=nf>printc</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>c</span><span class=p>,</span><span class=n>f</span><span class=p>,</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>f</span><span class=o>=</span><span class=n>f</span> <span class=ow>or</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>s</span><span class=o>=</span><span class=n>s</span> <span class=ow>or</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>w</span><span class=o>=</span><span class=n>print</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=o>-</span><span class=mi>8</span><span class=p>,</span><span class=o>-</span><span class=mi>8</span><span class=p>)</span><span class=o>*</span><span class=n>s</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>x</span><span class=o>=</span><span class=p>(</span><span class=mi>240</span><span class=o>-</span><span class=n>w</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>y</span><span class=o>=</span><span class=p>(</span><span class=mi>136</span><span class=o>-</span><span class=mi>6</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>c</span><span class=p>,</span><span class=n>f</span><span class=p>,</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><h2 id=simple-scene-manager>Simple Scene Manager</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- global game table</span>
</span></span><span class=line><span class=cl><span class=n>G</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>runtime</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>SM</span><span class=o>=</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- SCENE CLASS</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>scene</span><span class=o>=</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>scene</span><span class=p>:</span><span class=nf>new</span><span class=p>(</span><span class=n>o</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=o>=</span><span class=n>o</span> <span class=ow>or</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=n>self.__index</span><span class=o>=</span><span class=n>self</span>
</span></span><span class=line><span class=cl>    <span class=n>setmetatable</span><span class=p>(</span><span class=n>o</span><span class=p>,</span><span class=n>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o.timePassed</span><span class=o>=</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>o</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>scene</span><span class=p>:</span><span class=nf>onExit</span><span class=p>()</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>scene</span><span class=p>:</span><span class=nf>onEnter</span><span class=p>()</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- SCENE MANAGER CLASS</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>sceneManager</span><span class=o>=</span><span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>sceneManager</span><span class=p>:</span><span class=nf>create</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>self.__index</span><span class=o>=</span><span class=n>self</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=o>=</span><span class=n>setmetatable</span><span class=p>({},</span><span class=n>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o.currentScene</span><span class=o>=</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=n>o.scenes</span><span class=o>=</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>o</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>sceneManager</span><span class=p>:</span><span class=nf>addScene</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>table.insert</span><span class=p>(</span><span class=n>self.scenes</span><span class=p>,</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>sceneManager</span><span class=p>:</span><span class=nf>setCurrentScene</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>self.currentScene</span><span class=o>=</span><span class=n>s</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>sceneManager</span><span class=p>:</span><span class=nf>switchScene</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>if</span> <span class=n>self.currentScene</span><span class=o>~=</span><span class=n>s</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>        <span class=n>self.currentScene</span><span class=p>:</span><span class=n>onExit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>self.currentScene</span><span class=o>=</span><span class=n>s</span>
</span></span><span class=line><span class=cl>        <span class=n>self.currentScene</span><span class=p>:</span><span class=n>onEnter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- main</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>bootScene</span><span class=o>=</span><span class=n>scene</span><span class=p>:</span><span class=n>new</span><span class=p>({})</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>mainMenuScene</span><span class=o>=</span><span class=n>scene</span><span class=p>:</span><span class=n>new</span><span class=p>({})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>G.SM</span><span class=o>=</span><span class=n>sceneManager</span><span class=p>:</span><span class=n>create</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>G.SM</span><span class=p>:</span><span class=n>addScene</span><span class=p>(</span><span class=n>bootScene</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>G.SM</span><span class=p>:</span><span class=n>addScene</span><span class=p>(</span><span class=n>mainMenuScene</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>G.SM</span><span class=p>:</span><span class=n>setCurrentScene</span><span class=p>(</span><span class=n>bootScene</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>init</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>TIC</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>if</span> <span class=n>btnp</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>        <span class=kr>if</span> <span class=n>G.SM</span><span class=p>.</span><span class=n>currentScene</span><span class=o>==</span><span class=n>bootScene</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>            <span class=n>G.SM</span><span class=p>:</span><span class=n>switchScene</span><span class=p>(</span><span class=n>mainMenuScene</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=kr>else</span>
</span></span><span class=line><span class=cl>            <span class=n>G.SM</span><span class=p>:</span><span class=n>switchScene</span><span class=p>(</span><span class=n>bootScene</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=kr>end</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl>    <span class=n>G.SM</span><span class=p>.</span><span class=n>currentScene</span><span class=p>:</span><span class=n>update</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>G.SM</span><span class=p>.</span><span class=n>currentScene</span><span class=p>:</span><span class=n>draw</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>G.runtime</span><span class=o>=</span><span class=n>G.runtime</span><span class=o>+</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>printhc</span><span class=p>(</span><span class=s2>&#34;Press A to change the scene&#34;</span><span class=p>,</span><span class=mi>100</span><span class=p>,</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>rectb</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>240</span><span class=p>,</span><span class=mi>130</span><span class=p>,</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Boot Scene</span>
</span></span><span class=line><span class=cl><span class=n>bootScene.update</span><span class=o>=</span><span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>bootScene.timePassed</span><span class=o>=</span><span class=n>bootScene.timePassed</span><span class=o>+</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>bootScene.draw</span><span class=o>=</span><span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cls</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>printhc</span><span class=p>(</span><span class=s2>&#34;Boot Scene&#34;</span><span class=p>,</span><span class=mi>40</span><span class=p>,</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>printhc</span><span class=p>(</span><span class=s2>&#34;Scene time: &#34;</span> <span class=o>..</span> <span class=n>bootScene.timePassed</span><span class=p>,</span><span class=mi>50</span><span class=p>,</span><span class=mi>13</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>printhc</span><span class=p>(</span><span class=s2>&#34;Global time: &#34;</span> <span class=o>..</span> <span class=n>G.runtime</span><span class=p>,</span><span class=mi>60</span><span class=p>,</span><span class=mi>14</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Main Menu Scene</span>
</span></span><span class=line><span class=cl><span class=n>mainMenuScene.update</span><span class=o>=</span><span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>mainMenuScene.timePassed</span><span class=o>=</span><span class=n>mainMenuScene.timePassed</span><span class=o>+</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>mainMenuScene.draw</span><span class=o>=</span><span class=kr>function</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>cls</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>printhc</span><span class=p>(</span><span class=s2>&#34;Main Menu Scene&#34;</span><span class=p>,</span><span class=mi>40</span><span class=p>,</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>printhc</span><span class=p>(</span><span class=s2>&#34;Scene time: &#34;</span> <span class=o>..</span> <span class=n>mainMenuScene.timePassed</span><span class=p>,</span><span class=mi>50</span><span class=p>,</span><span class=mi>13</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>printhc</span><span class=p>(</span><span class=s2>&#34;Global time: &#34;</span> <span class=o>..</span> <span class=n>G.runtime</span><span class=p>,</span><span class=mi>60</span><span class=p>,</span><span class=mi>14</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- short general helper functions</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>max</span><span class=p>(</span><span class=n>n1</span><span class=p>,</span><span class=n>n2</span><span class=p>)</span> <span class=kr>return</span> <span class=n>math.max</span><span class=p>(</span><span class=n>n1</span><span class=p>,</span><span class=n>n2</span><span class=p>)</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>printhc</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>w</span><span class=o>=</span><span class=n>print</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=o>-</span><span class=mi>8</span><span class=p>,</span><span class=o>-</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>local</span> <span class=n>x</span><span class=o>=</span><span class=p>(</span><span class=mi>240</span><span class=o>-</span><span class=n>w</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>    <span class=n>print</span><span class=p>(</span><span class=n>t</span><span class=p>,</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>,</span><span class=n>c</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div><h2 id=finite-state-machine>Finite state machine</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- FINITE STATE MACHINE</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Machine</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>fsmBase</span><span class=o>=</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>fsmBase</span><span class=p>:</span><span class=nf>new</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>self.__index</span><span class=o>=</span><span class=n>self</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=o>=</span><span class=n>setmetatable</span><span class=p>({},</span><span class=n>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o.states</span><span class=o>=</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=n>o.curState</span><span class=o>=</span><span class=kc>nil</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>o</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>fsmBase</span><span class=p>:</span><span class=nf>addState</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>self.states</span><span class=p>[</span><span class=n>s.name</span><span class=p>]</span><span class=o>=</span><span class=n>s</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>fsmBase</span><span class=p>:</span><span class=nf>setCurrentState</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>self.curState</span><span class=o>=</span><span class=n>s</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>fsmBase</span><span class=p>:</span><span class=nf>update</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>self.curState</span><span class=p>:</span><span class=n>onUpdate</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>fsmBase</span><span class=p>:</span><span class=nf>switch</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>if</span> <span class=n>self.curState</span><span class=p>.</span><span class=n>name</span><span class=o>~=</span><span class=n>n</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>        <span class=n>self.curState</span><span class=p>:</span><span class=n>onExit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>self.curState</span><span class=o>=</span><span class=n>self.states</span><span class=p>[</span><span class=n>n</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>self.curState</span><span class=p>:</span><span class=n>onEnter</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- Base State</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>baseState</span><span class=o>=</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>baseState</span><span class=p>:</span><span class=nf>new</span><span class=p>(</span><span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>self.__index</span><span class=o>=</span><span class=n>self</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span><span class=o>=</span><span class=n>setmetatable</span><span class=p>({},</span><span class=n>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o.name</span><span class=o>=</span><span class=n>n</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>o</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>baseState</span><span class=p>:</span><span class=nf>onEnter</span><span class=p>()</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>baseState</span><span class=p>:</span><span class=nf>onUpdate</span><span class=p>()</span> <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>baseState</span><span class=p>:</span><span class=nf>onExit</span><span class=p>()</span> <span class=kr>end</span>
</span></span></code></pre></div><h2 id=simple-particle-system>Simple particle system</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=c1>-- SIMPLE PARTICLE CLASS</span>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>particles</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>local</span> <span class=n>particle</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>particle</span><span class=p>:</span><span class=nf>new</span><span class=p>(</span><span class=n>x</span><span class=p>,</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>self.__index</span><span class=o>=</span><span class=n>self</span>
</span></span><span class=line><span class=cl>    <span class=n>o</span> <span class=o>=</span> <span class=n>setmetatable</span><span class=p>({},</span> <span class=n>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o.x</span> <span class=o>=</span> <span class=n>x</span>
</span></span><span class=line><span class=cl>    <span class=n>o.y</span> <span class=o>=</span> <span class=n>y</span>
</span></span><span class=line><span class=cl>    <span class=n>o.dx</span> <span class=o>=</span> <span class=n>rnd</span><span class=p>(</span><span class=o>-</span><span class=mi>8</span><span class=p>,</span><span class=mi>8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o.dy</span> <span class=o>=</span> <span class=n>rnd</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o.life</span> <span class=o>=</span> <span class=n>rnd</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>o.color</span> <span class=o>=</span> <span class=n>rnd</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span><span class=mi>15</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>return</span> <span class=n>o</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>particle</span><span class=p>:</span><span class=nf>update</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>self.x</span> <span class=o>=</span> <span class=n>self.x</span> <span class=o>+</span> <span class=n>self.dx</span>
</span></span><span class=line><span class=cl>    <span class=n>self.y</span> <span class=o>=</span> <span class=n>self.y</span> <span class=o>+</span> <span class=n>self.dy</span>
</span></span><span class=line><span class=cl>    <span class=n>self.life</span> <span class=o>=</span> <span class=n>self.life</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=kr>if</span> <span class=n>self.life</span> <span class=o>&lt;</span> <span class=mi>0</span> <span class=kr>then</span>
</span></span><span class=line><span class=cl>        <span class=kd>local</span> <span class=n>i</span> <span class=o>=</span> <span class=n>tblFind</span><span class=p>(</span><span class=n>particles</span><span class=p>,</span><span class=n>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>table.remove</span><span class=p>(</span><span class=n>particles</span><span class=p>,</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nc>particle</span><span class=p>:</span><span class=nf>draw</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>pix</span><span class=p>(</span><span class=n>self.x</span><span class=p>,</span><span class=n>self.y</span><span class=p>,</span><span class=n>self.color</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>-- main</span>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>TIC</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ins</span><span class=p>(</span><span class=n>particles</span><span class=p>,</span><span class=n>particle</span><span class=p>:</span><span class=n>new</span><span class=p>(</span><span class=mi>118</span><span class=p>,</span><span class=mi>58</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>updateParticles</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>drawParticles</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>updateParticles</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>for</span> <span class=n>_</span><span class=p>,</span><span class=n>v</span> <span class=kr>in</span> <span class=n>pairs</span><span class=p>(</span><span class=n>particles</span><span class=p>)</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>        <span class=n>v</span><span class=p>:</span><span class=n>update</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>function</span> <span class=nf>drawParticles</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>for</span> <span class=n>_</span><span class=p>,</span><span class=n>v</span> <span class=kr>in</span> <span class=n>pairs</span><span class=p>(</span><span class=n>particles</span><span class=p>)</span> <span class=kr>do</span>
</span></span><span class=line><span class=cl>        <span class=n>v</span><span class=p>:</span><span class=n>draw</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=kr>end</span>
</span></span><span class=line><span class=cl><span class=kr>end</span>
</span></span></code></pre></div></div></div><footer class="text-light mb-5 small text-center">Copyright &#169; 2024 digitsensitive</footer></body></html>